
%script{:src => "//maps.google.com/maps/api/js?v=3.23&key=AIzaSyCHo7P-uEfAEioZyTEw51cjJxfGlQf5tiM"}
%script{:src => "//cdn.rawgit.com/mahnunchik/markerclustererplus/master/dist/markerclusterer.min.js"}
%script{:src => "//cdn.rawgit.com/printercu/google-maps-utility-library-v3-read-only/master/infobox/src/infobox_packed.js", :type => "text/javascript"}


.wrapper_with_padding
  #appointment_background
    .panel.panel-default
      .panel-body
        .row
          .col-md-8
            #appointments.transitions-enabled
              - @appointments.each_with_index do |appointment, i|
                %a{ href: (url_for [appointment])}
                  .box.panel.panel-default
                    .panel-heading
                      %h2= appointment.user.username
                    .panel-body
                      %img.img-rounded.center-block{alt: "Profile Picture", src: appointment.user.avatar.url(:thumb)}/
                    .panel-footer
                      .stars
                        %p= appointment.title
                        

          .col-md-4
            %img{:style => "width: 100%;"}
              #map{:style => "width: 100%; height: 400px;"} 
            %p 
            = form_tag appointments_path, :method => :get do
              %p= text_field_tag :search, params[:search], placeholder: 'Update your search here...'
              %p= submit_tag "Refresh Search", :search => nil
              %br
            %p
            = link_to "Create Appointment", root_path, class: "button"
            %p
            = link_to "Book A Trainer", appointments_path, class: "button"

:javascript
  handler = Gmaps.build('Google');
  handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
    markers = handler.addMarkers(#{raw @hash.to_json});
    handler.bounds.extendWith(markers);
    handler.fitMapToBounds();
  });